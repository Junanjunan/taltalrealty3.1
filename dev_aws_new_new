https://docs.aws.amazon.com/ko_kr/elasticbeanstalk/latest/dg/create-deploy-python-container.html

https://blog.hbsmith.io/elastic-beanstalk-amazon-linux2-python-%ED%99%98%EA%B2%BD-%EB%A7%88%EC%9D%B4%EA%B7%B8%EB%A0%88%EC%9D%B4%EC%85%98-%ED%9B%84%EA%B8%B0-96fe21370d84
pythonpath가 제대로 설정되어 있지 않아서 eb create는 되는데 eb deploy가 계속 에러?

python version 3.8.10 64-bit

$ pipenv shell
    -> Pipfile 생성됨
        -> 이용하던 Pipfile 있어서 삭제하고 그 파일 붙여넣기함
            - pipenv install : 불러온 Pipfile에 기록되어 있는 library등 일괄 설치
            - .env 등을 포함해서 django app 그대로 가져옴
                - .env 적용시키려면 vsc 껐다 키기
            - python manage.py makemigrations / migrate / createsuperuser / runserver로 작동 되는지 확인


.ebextensions/02-django.config
  container_commands:
    01_migrate:
      command: "django-admin migrate"
      leader_only: true
    02_createsu:
      command: "django-admin createsu"
  option_settings:
    aws:elasticbeanstalk:container:python:
      WSGIPath: config/wsgi.py
    aws:elasticbeanstalk:application:environment:
      DJANGO_SETTINGS_MODULE: config.settings

    -> static 관련된 부분 우선 삭제하고 진행

config/settings.py
    static 관련된 부분 주석처리하고 진행

기본 세팅들이 되어있으니, eb create를 하기 전에 RDS를 먼저 만들어보자.

AWS RDS 생성
    - PostgreSQL , 버전: PostgreSQL 13.4-R1 (default), 프리티어
    - DB 인스턴스 식별자: taltalrealty3
    - 마스터 사용자 이름: postgres (default)
    - 마스터 암호: @ 사용 안됨
    - 추가 구성 / 데이터베이스 옵션 / 초기 데이터베이스 이름 설정 
      ->  "데이터베이스 이름을 지정하지 않으면 Amazon RDS에서 데이터베이스를 생성하지 않습니다." 라고 설명
          실제로 이걸 안해줘서 오류 발생
    - DB 인스턴스 클래스: 버스터블 클래스(t클래스 포함) - db.t3.micro 선택 (default)
    - 나머지 설정 default로 놔두고 생성

    요금 설명
      Amazon RDS 프리 티어는 12개월 동안 사용할 수 있습니다. 매월 프리 티어를 통해 아래 나열된 Amazon RDS 리소스를 무료로 사용할 수 있습니다.
      단일 AZ db.t2.micro 인스턴스에서 Amazon RDS의 750시간.
      20GB의 범용 스토리지(SSD).
      20GB의 자동 백업 스토리지 및 사용자가 시작한 모든 DB 스냅샷.
      AWS 무료 티어에 대해 자세히 알아보세요.
      무료 사용이 만료되었거나 애플리케이션에서 프리 티어 사용량을 초과한 경우 Amazon RDS 요금 페이지에서 설명한 대로, 표준 종량 서비스 요금이 적용됩니다.
      Amazon RDS 요금 설명: https://aws.amazon.com/ko/rds/pricing/


$ eb init
    - seoul 선택 (10번)
    - Create New Application (2번) 선택
    - Enter Application Name : taltalrealty3.1
    - It appears you are using Python. Is this correct? Y
    - Select a platform branch. 1) Python 3.8
    - Do you wish to continue with CodeCommit? n
    - Do you want to set up SSH for your instances? Y
        - Select a keypair. 2) Create new KeyPair
            - Type a keypair name: aws-eb-taltalrealty2
                Enter passphrase(empty for no passphrase): 비어있는 상태로 엔터
                Enter same passphrase again: 그대로 엔터

$ pipenv install pipenv-to-requirements
    $ pipenv lock -r > requirements.txt

$ git add . / git commit -m "." / eb create
    - Enter Environment Name: taltalrealty31-dev
    - Enter DNS CNAME prefix: taltalrealty31-dev
    - Select a load balancer type
        1) classic
        2) application
        3) network
        (default is2): 엔터
    - Would you like to enable spot Fleet requests for this environment? N

여기까지 진행하고 웹 실행해보면
    502 Bad Gateway
    nginx/1.20.0

eb logs --all 을 통해 log를 보
별다른 오류가 발생하지 않았음.

Elastic Beanstalk 구성 설정(configurations)해서 .env 변수들 추가하고, RDS 연결.

아직 안되었음

Elastic Beanstalk 구성을 보면
DJANGO_SETTINGS_MODULE이 없음. wsgi 설정을 잘못해서 그런듯...?

cfn-init.log: cfnbootstrap.construction_errors.ToolError: Command 01_migrate failed
cfn-init-cmd.log: ModuleNotFoundError: No module named 'config'

.ebextensions/02-django.config
  container_commands:
    01_migrate:
      command: "django-admin migrate"
      leader_only: true
    02_createsu:
      command: "django-admin createsu"
  option_settings:
    aws:elasticbeanstalk:container:python:
      WSGIPath: config.wsgi:application     # 이 부분만 수정해보고 진행
    aws:elasticbeanstalk:application:environment:
      DJANGO_SETTINGS_MODULE: config.settings

위와 같이 해주고 다시 eb deploy 

cfn-init.log: cfnbootstrap.construction_errors.ToolError: Command 01_migrate failed
cfn-init-cmd.log: ModuleNotFoundError: No module named 'config'

여전히 마찬가지임.
Elastic Beanstalk 구성 설정에
DJANGO_SETTINGS_MODULE이 빠져있고, WSGIPath도 업데이트가 안되고 application으로 되어있어서 그런것 같음...

보통은 생성할때 위 2개가 설정이 되어있었는데,
django-config 파일을 오타(띄어쓰기)를 내서 설정이 잘못된거 같기도 함

DJANGO_SETTINGS_MODULE은 수동으로 추가해줌
DJANGO_SETTINGS_MODULE : config.settings

컨테이너 옵션에서
WSGIPath 수동 추가 config.wsgi:application


이렇게 해주니까 되었음

django.config 에서 띄어쓰기 오타때문에 업로드가 안된건지 모르니, eb terminate 해주고 다시 해보자.

.elasticbeanstalk도 삭제해주고 다시 eb init부터

다시 해주니까
WSGIPath, DJANGO_SETTINGS_MODULE 설정되어있음

이제 다시등록

잘 됨

근데 수정할거 있어서 수정해주고 eb deploy 해주니 또 안됨
또 같은 에러 발생
cfn-init.log: cfnbootstrap.construction_errors.ToolError: Command 01_migrate failed
cfn-init-cmd.log: ModuleNotFoundError: No module named 'config'

https://blog.hbsmith.io/elastic-beanstalk-amazon-linux2-python-%ED%99%98%EA%B2%BD-%EB%A7%88%EC%9D%B4%EA%B7%B8%EB%A0%88%EC%9D%B4%EC%85%98-%ED%9B%84%EA%B8%B0-96fe21370d84
pythonpath가 제대로 설정되어 있지 않아서 eb create는 되는데 eb deploy가 계속 에러?

아무래도 이게 맞는 듯,
노마드 강의를 보면
PYTHONPATH가 설정되어 있지 않은데,

지금 Elastic Beanstalk를 생성하면, PYTHONPATH가 default로
/var/app/venv/staging-LQM1lest/bin 으로 설정되어있음

이를 지워주고 해보자
-> 지워도 다시 생성됨 eb deploy를 하면